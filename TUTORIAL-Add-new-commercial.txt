# Guide : Configuration des commerciaux pour le syst√®me RDV

## üéØ Objectif
Ajouter les 2 autres commerciaux au syst√®me de prise de rendez-vous automatique.

---

## üìã Pr√©requis
- Emails Google/Gmail des 2 commerciaux
- Ils doivent utiliser Google Agenda (Google Calendar)
- Acc√®s √† votre projet Laravel

---

## üìß √âtape 1 : Email √† envoyer aux commerciaux

Copiez-collez ce message √† vos commerciaux :

```
Objet : Configuration Google Agenda - Syst√®me RDV automatique

Bonjour [Nom du commercial],

Pour activer la prise de rendez-vous automatique sur notre site web, vous devez partager votre agenda Google avec notre syst√®me.

√âTAPES √Ä SUIVRE :

1. Allez sur Google Agenda : https://calendar.google.com
2. Dans la liste de vos agendas (colonne de gauche), trouvez votre agenda principal (souvent votre nom)
3. Cliquez sur les 3 points √† c√¥t√© de votre agenda
4. Cliquez sur "Param√®tres et partage"
5. Descendez jusqu'√† "Partager avec des personnes en particulier"
6. Cliquez sur "Ajouter des personnes"
7. Ajoutez cette adresse EMAIL EXACTE : 
   laravel-calendar-booking@hrtelecoms-462011.iam.gserviceaccount.com
8. Dans les permissions, choisissez "Apporter des modifications aux √©v√©nements"
9. Cliquez sur "Envoyer"

‚ö†Ô∏è IMPORTANT : Utilisez exactement cette adresse email, sans faute de frappe.

Cette manipulation permet au site web de :
- Voir vos cr√©neaux occup√©s
- Cr√©er automatiquement les RDV dans votre agenda
- √âviter les conflits de planning

Merci de me confirmer quand c'est fait !

Cordialement,
[Votre nom]
```

---

## üîß √âtape 2 : Test de la configuration

### 2a. Route de test
Ajoutez cette route temporaire dans `routes/web.php` :

```php
Route::get('/test-commercial-access/{email}', function ($email) {
    $calendarService = new GoogleCalendarService();
    return response()->json($calendarService->testDirectAccess($email));
});
```

### 2b. Test pour chaque commercial
Une fois qu'un commercial a fait le partage, testez :

```
http://votre-site.local/test-commercial-access/email-du-commercial@gmail.com
```

**R√©sultat attendu :**
```json
{
  "access": "OK",
  "calendar_id": "email-du-commercial@gmail.com",
  "calendar_summary": "email-du-commercial@gmail.com",
  "timezone": "Europe/Paris"
}
```

**Si erreur :** Le commercial n'a pas encore fait le partage ou s'est tromp√© d'email.

---

## ‚öôÔ∏è √âtape 3 : Mise √† jour de la configuration

### 3a. Modifier `config/commerciaux.php`

Remplacez le contenu par :

```php
<?php

return [
    'commerciaux' => [
        [
            'id' => 1,
            'nom' => 'David ICHIDO',
            'email' => 'doko972@gmail.com',
            'calendar_id' => 'doko972@gmail.com',
            'specialites' => ['T√©l√©coms', 'Internet'],
        ],
        [
            'id' => 2,
            'nom' => 'VRAI NOM COMMERCIAL 2',  // ‚Üê √Ä modifier
            'email' => 'email-commercial2@gmail.com',  // ‚Üê √Ä modifier
            'calendar_id' => 'email-commercial2@gmail.com',  // ‚Üê √Ä modifier
            'specialites' => ['S√©curit√©', 'R√©seau'],  // ‚Üê √Ä modifier si besoin
        ],
        [
            'id' => 3,
            'nom' => 'VRAI NOM COMMERCIAL 3',  // ‚Üê √Ä modifier
            'email' => 'email-commercial3@gmail.com',  // ‚Üê √Ä modifier
            'calendar_id' => 'email-commercial3@gmail.com',  // ‚Üê √Ä modifier
            'specialites' => ['Maintenance', 'Support'],  // ‚Üê √Ä modifier si besoin
        ],
    ]
];
```

### 3b. Mise √† jour du JavaScript

Dans votre fichier JavaScript, remplacez la fonction `loadCommerciaux()` :

```javascript
function loadCommerciaux() {
    if (!commercialSelect) return;
    
    // NOUVEAU : R√©cup√©ration dynamique via API (optionnel)
    // Ou mise √† jour manuelle :
    const commerciaux = [
        { id: 1, nom: 'David ICHIDO', specialites: 'T√©l√©coms, Internet' },
        { id: 2, nom: 'VRAI NOM COMMERCIAL 2', specialites: 'S√©curit√©, R√©seau' },  // ‚Üê √Ä modifier
        { id: 3, nom: 'VRAI NOM COMMERCIAL 3', specialites: 'Maintenance, Support' },  // ‚Üê √Ä modifier
    ];
    
    commercialSelect.innerHTML = '<option value="">S√©lectionnez un commercial</option>';
    
    commerciaux.forEach(commercial => {
        const option = document.createElement('option');
        option.value = commercial.id;
        option.textContent = `${commercial.nom} - ${commercial.specialites}`;
        commercialSelect.appendChild(option);
    });
}
```

---

## ‚úÖ √âtape 4 : Tests complets

### 4a. Test des cr√©neaux disponibles
Pour chaque commercial configur√© :

```
http://votre-site.local/test-disponibilites?date=2025-06-11
```

Changez le param√®tre `commercial` dans la route `/api/available-slots` pour tester chaque commercial.

### 4b. Test de prise de RDV
1. Allez sur le formulaire de contact
2. S√©lectionnez "Prise de rendez-vous"
3. Testez chaque commercial dans la liste
4. V√©rifiez que les cr√©neaux se chargent
5. Cr√©ez un RDV de test
6. V√©rifiez qu'il appara√Æt dans l'agenda du commercial

### 4c. Test des conflits
1. Cr√©ez un √©v√©nement manuellement dans l'agenda d'un commercial
2. Essayez de prendre RDV au m√™me cr√©neau via le site
3. V√©rifiez que le cr√©neau n'appara√Æt pas dans la liste

---

## üêõ D√©pannage

### Probl√®me : "Commercial introuvable"
- V√©rifiez que l'ID du commercial existe dans `config/commerciaux.php`
- V√©rifiez que les guillemets sont corrects dans le config

### Probl√®me : "Erreur d'acc√®s au calendrier"
- Le commercial n'a pas fait le partage
- Mauvaise adresse email utilis√©e pour le partage
- Permissions insuffisantes (doit √™tre "Apporter des modifications")

### Probl√®me : "Cr√©neaux ne se chargent pas"
- V√©rifiez les logs Laravel : `storage/logs/laravel.log`
- Testez la route `/test-commercial-access/email` directement
- V√©rifiez que le JavaScript n'a pas d'erreurs (console navigateur)

### Probl√®me : "Mauvais fuseau horaire"
- V√©rifiez que votre `.env` contient : `APP_TIMEZONE=Europe/Paris`
- Les commerciaux doivent √™tre en France ou avoir configur√© le bon fuseau

---

## üîÑ Nettoyage final

Une fois tout configur√© et test√©, supprimez les routes de test :

```php
// Supprimer ces routes de routes/web.php :
Route::get('/test-calendar', ...);
Route::get('/test-direct-access', ...);
Route::get('/test-disponibilites', ...);
Route::get('/test-slot-check', ...);
Route::get('/test-commercial-access/{email}', ...);
Route::get('/debug-calendar', ...);
Route::get('/create-test-event', ...);
Route::get('/list-calendars', ...);
```

---

## üìà R√©sultat final

‚úÖ **3 commerciaux op√©rationnels**  
‚úÖ **Syst√®me anti-conflit actif**  
‚úÖ **Interface utilisateur compl√®te**  
‚úÖ **Cr√©neaux en temps r√©el**  
‚úÖ **Emails de notification**  

**Le syst√®me de RDV est maintenant compl√®tement autonome !** üéâ

---

## üìû Support

Si vous rencontrez des difficult√©s :
1. V√©rifiez les logs Laravel
2. Testez √©tape par √©tape avec les routes de debug
3. Contactez les commerciaux pour confirmer le partage
4. V√©rifiez les permissions Google Calendar